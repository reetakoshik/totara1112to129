define(["jquery","core/config","core/localstorage","core/ajax"],function(a,b,c,d){var e=!1,f=!1,g=[],h=function(){var a="core_flex_icon/"+b.theme+"/cache";e=!0;var h=c.get(a);if(h)f=JSON.parse(h);else{var i=d.call([{methodname:"core_output_get_flex_icons",args:{themename:b.theme}}],!0,!1);i[0].done(function(b){c.set(a,JSON.stringify(b)),f=b;for(var d=0;d<g.length;d++)g[d].resolve()})}},i={loadingflex:[],loadingtranslation:[],getFlexTemplateData:function(b){var c=a.Deferred(),d=function(){if("undefined"==typeof f.icons[b])return void c.reject();var a=f.icons[b],d={data:JSON.parse(JSON.stringify(f.datas[a[1]])),template:f.templates[a[0]]};d.data.identifier=b,c.resolve(d)};if(f)d();else{var e=a.Deferred();e.done(function(){d()}),g.push(e)}return c.promise()},getIconData:function(c,d,e){var f=a.Deferred(),g=this;return d&&""===d&&"moodle"!=d&&"core"!=d||(d="core"),"undefined"==typeof e.title&&"undefined"!=typeof e.alt&&(e.title=e.alt),this.getFlexTemplateData(d+"|"+c).then(function(a){var b={template:a.template,context:a.data};b.context.customdata=e,f.resolve(b)}).fail(function(){g.getFlexTemplateData(c).then(function(a){var b={template:a.template,context:a.data};b.context.customdata=e,f.resolve(b)}).fail(function(){var a={template:"core/pix_icon",context:{}},g=[];for(var h in e)e.hasOwnProperty(h)&&g.push({name:h,value:e[h]});var i=b.wwwroot+"/theme/image.php";i+=b.themerev>0&&1==b.slasharguments?"/"+b.theme+"/"+d+"/"+b.themerev+"/"+c:"?theme="+b.theme+"&component="+d+"&rev="+b.themerev+"&image="+c,g.push({name:"src",value:i}),a.context.attributes=g,f.resolve(a)})}),f.promise()}};return e||h(),i});