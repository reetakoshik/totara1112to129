define(["jquery","core/config","core/templates"],function(a,b,c){var d={change_links:function(e,f){var g=null;a(".block_totara_report_table."+e+" .content .rb-display-table-container").find("div.paging a, th.header a").each(function(){a(this).click(function(h){h.preventDefault();var i=a(this),j=i.attr("href"),k=j.slice(j.indexOf("?")+1);if(k+="&sesskey="+b.sesskey+"&blockid="+f,g&&g.abort(),0===a(h.target).siblings(".block_totara_report_table_instant_wait").length){var l=a('<div class="block_totara_report_table_instant_wait"></div>'),m=a(".block_totara_report_table."+e+" .content .rb-display-table-container");m.addClass("block_totara_report_table_loading"),m.append(l),c.renderIcon("loading","","ft-size-600").done(function(a){l.html(a);var b=m.position();b.left+=m.width()/2-l.width()/2,b.top+=m.height()/2-l.height()/2,l.css(b)})}g=d.refresh_results(e,k,function(){d.change_links(e,f)})})})},refresh_results:function(c,d,e){return a.get(b.wwwroot+"/blocks/totara_report_table/ajax_instantreport.php?"+d).done(function(b){var d=a(".block_totara_report_table."+c+" .content");d.find(".block_totara_report_table_instant_wait").remove(),d.find(".rb-display-table-container").remove(),d.prepend(a(b).find(".rb-display-table-container")),d.find("form").remove(),e&&e()})},populatelist:function(){var c=a("#id_config_savedsearch");a("#id_config_reportid").change(function(){var d=a(this).val();""!==d&&(c.attr("disabled","disabled"),M.util.js_pending("block_totara_report_table-populatelist"),a.ajax({type:"POST",url:b.wwwroot+"/blocks/totara_report_table/ajax_list_saved.php",data:{reportid:d,sesskey:M.cfg.sesskey},success:function(a){c.find("option").remove(),c.append('<option value="">'+M.util.get_string("allavailabledata","block_totara_report_table")+"</option>");for(var b in a)c.append('<option value="'+b+'">'+a[b]+"</option>");c.removeAttr("disabled"),M.util.js_complete("block_totara_report_table-populatelist")}}))})}};return d});