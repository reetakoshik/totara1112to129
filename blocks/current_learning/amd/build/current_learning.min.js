define(["jquery","core/templates","core/notification","core/str","core/log"],function(a,b,c,d,e){var f,g=null,h=10,i=function(b,c){var e=parseInt(a(f+" .pagination li.active a").attr("data-page")),g=null;g="next"==c?e+1:"prev"==c?e-1:c;var i=b.learningitems.length,j=Math.ceil(i/h),k={},l=(g-1)*h+1;k.learningitems=b.learningitems.slice(l-1,l-1+h);var m=b.pagination;g>1?m.previousclass="":m.previousclass="disabled",g>=j?m.nextclass="disabled":m.nextclass="",m.pages.forEach(function(a){a.page==g?a.active="active":a.active=""});var n={},o=a.Deferred();n.start=(g-1)*h+1;var p=null;return p=b.pagination.totalitems<g*h?b.pagination.totalitems:g*h,n.end=p,n.total=b.pagination.totalitems,d.get_string("displayingxofx","block_current_learning",n).done(function(a){m.text=a,k.pagination=m,k.haslearningitems=!0,o.resolve(k)}).fail(function(a){o.reject(a)}),o.promise()},j=function(){a(f+" .pagination").on("click","a",function(d){d.preventDefault();var e=a(this),h=e.parent();if(h.hasClass("disabled"))return!1;var k=e.attr("data-page");i(g,k).done(function(d){b.render("block_current_learning/main_content",d).done(function(c,d){a(f+" .current-learning-content").replaceWith(c).trigger("block_current_learning:content_updated"),b.runTemplateJS(d)}).fail(function(a){c.exception(a)}),b.render("block_current_learning/paging",d).done(function(b){a(f+" .panel-footer").replaceWith(b),j()}).fail(function(a){c.exception(a)})})})},k=function(){var b=f+' [data-toggle="tooltip"]';a(b).tooltip(),a(f+" .current-learning-content").on("block_current_learning:content_updated",function(c){a(b).tooltip()})},l=function(b){if(b.pagination.pages.length>1){var c=a(f+" .current-learning-content");c.css("min-height",c.outerHeight())}},m=function(c){f="#inst"+c.instanceid.toString(),c.pagination&&c.pagination.itemsperpage&&(h=c.pagination.itemsperpage);var i=!0;a.fn.collapse&&a.fn.tooltip||(e.debug("Current learning block requires Bootstrap 3 JavaScript, please include it or find your own solution."),i=!1),g=c;var m=["block_current_learning/main_content","block_current_learning/course_row","block_current_learning/program_row"];if(m.forEach(function(a){b.render(a,{})}),c.pagination){var n={pagination:{onepage:!1,previousclass:"disabled",nextclass:""}};b.render("block_current_learning/paging",n),d.get_string("displayingxofx","block_current_learning",{start:1,end:2,total:2}),j(),l(c)}i&&k()};return{init:m}});