define(["jquery","core/config","core/templates"],function(a,b,c){var d={xhr:null,init:function(){a(".rb-sidebar input:not(.ignoredirty), .rb-sidebar select").change(function(b){try{var e=a(this).parents("form").attr("id");M.form.updateFormState(e)}catch(f){}d.xhr&&d.xhr.abort(),0===a(b.target).siblings(".instantfilterwait").length&&c.renderIcon("loading","loading","instantfilterwait").done(function(c){a(c).insertAfter(a(b.target).parent().children().last())}),d.xhr=d.refresh_results()})},split_search:function(a){var b={};if(void 0===a||a.length<1)return b;for(var c=a.slice(1).split("&"),d=0;d<c.length;d++){var e=c[d].split("="),f=decodeURIComponent(e[0]).replace(/\+/g," "),g=decodeURIComponent(e[1]).replace(/\+/g," ");void 0===b[f]&&(b[f]=[]),b[f].push(g)}return b},remove_param:function(a,b){return a[b]&&delete a[b],a},build_search:function(a){var b="?";for(var c in a)for(var d=0;d<a[c].length;d++)b+="?"==b?"":"&",b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c][d]);return b},refresh_results:function(c){var e=window.location.search,f=d.split_search(e);return f=d.remove_param(f,"spage"),f=d.remove_param(f,"ssort"),f=d.remove_param(f,"sid"),f=d.remove_param(f,"clearfilters"),e=d.build_search(f),a.post(b.wwwroot+"/totara/reportbuilder/ajax/instantreport.php"+e,a(".rb-sidebar").serialize()).done(function(b){var d=a(".instantfilterwait");d.siblings(".sr-only").remove(),d.remove(),a(".rb-display-table-container").replaceWith(a(b).find(".rb-display-table-container")),a(".rb-record-count").replaceWith(a(b).find(".rb-record-count")),a(".rb-report-svggraph").replaceWith(a(b).find(".rb-report-svggraph")),a(".rb-report-pdfgraph").replaceWith(a(b).find(".rb-report-pdfgraph")),a(b).find(".rb-sidebar.mform label").each(function(b,c){var d=a(c);d.attr("for")&&a('label[for="'+d.attr("for")+'"]').html(d.html())}),c&&c()})}};return d});