define(["jquery","core/config","core/str"],function(a,b,c){var d=function(d,e){if(c.get_string("assignrelatedcompetencies","totara_hierarchy").done(function(a){var c=b.wwwroot+"/totara/hierarchy/prefix/competency/related/";totaraMultiSelectDialog("related",a,c+"find.php?sesskey="+b.sesskey+"&id="+d,c+"save.php?sesskey="+b.sesskey+"&id="+d+"&deleteexisting=1&add=")}),"undefined"!=typeof e&&e)totaraDialog_handler_assignEvidence=function(){},totaraDialog_handler_assignEvidence.prototype=new totaraDialog_handler_treeview,totaraDialog_handler_assignEvidence.prototype._handle_update_hierarchy=function(b){var c=this;a("span",b).click(function(){var b=a(this).parent(),d=b.attr("id").substr(10);"cat"!=d.substr(0,3)&&c._handle_course_click(d)})},totaraDialog_handler_assignEvidence.prototype._handle_course_click=function(a){var b=this.baseurl+"course.php?id="+a+"&competency="+d;this._dialog.showLoading(),this._dialog._request(b,{object:this,method:"_display_evidence"})},totaraDialog_handler_assignEvidence.prototype._display_evidence=function(c){this._dialog.hideLoading(),a(".selected",this._dialog.dialog).html(c);var e=this;a("#available-evidence",this._dialog.dialog).find(".addbutton").click(function(c){c.preventDefault();var f=a(this).parent().attr("type"),g=a(this).parent().attr("id"),h=e.baseurl+"add.php?sesskey="+b.sesskey+"&competency="+d+"&type="+f+"&instance="+g;e._dialog._request(h,{object:e,method:"_update"})})};else{totaraDialog_handler_compEvidence=function(){},totaraDialog_handler_compEvidence.prototype=new totaraDialog_handler_treeview_multiselect,totaraDialog_handler_compEvidence.prototype._update=function(b){this._dialog.hide(),a(".noitems-"+this._title).remove();var c=a(b).find("#list-evidence"),d=a("#list-evidence");d.length?d.replaceWith(c):a("div#evidence-list-container").append(c)};var f=b.wwwroot+"/totara/hierarchy/prefix/competency/evidenceitem/",g=f+"add.php?sesskey="+b.sesskey+"&competency="+d+"&type=coursecompletion&instance=0&deleteexisting=1&update=",h={},i=new totaraDialog_handler_compEvidence;i.baseurl=f;var j=[];j.push({key:"save",component:"totara_core"}),j.push({key:"cancel",component:"moodle"}),j.push({key:"assigncoursecompletions",component:"totara_hierarchy"}),c.get_strings(j).done(function(a){for(var b=[],c=0;c<j.length;c++)b[j[c].key]=a[c];h[b.save]=function(){i._save(g)},h[b.cancel]=function(){i._cancel()},totaraDialogs.evidence=new totaraDialog("evidence","show-evidence-dialog",{buttons:h,title:"<h2>"+b.assigncoursecompletions+"</h2>"},f+"edit.php?id="+d,i)})}if("undefined"!=typeof e&&e){var j=[];j.push({key:"cancel",component:"moodle"}),j.push({key:"assignnewevidenceitem",component:"totara_hierarchy"}),c.get_strings(j).done(function(a){for(var c=[],e=0;e<j.length;e++)c[j[e].key]=a[e];var f=b.wwwroot+"/totara/hierarchy/prefix/competency/evidenceitem/",g={},h=new totaraDialog_handler_assignEvidence;h.baseurl=f,g[c.cancel]=function(){h._cancel()},totaraDialogs.evidence=new totaraDialog("evidence","show-evidence-dialog",{buttons:g,title:"<h2>"+c.assignnewevidenceitem+"</h2>"},f+"edit.php?id="+d,h)})}};return{item:function(b,c){var e=a.Deferred();e.done(function(){d(b,c)}),window.dialogsInited?e.resolve():(a.isArray(window.dialoginits)||(window.dialoginits=[]),window.dialoginits.push(e.resolve))},template:function(d){var e=a.Deferred();e.done(function(){var a=b.wwwroot+"/totara/hierarchy/prefix/competency/template/";c.get_string("assignnewcompetency","competency").done(function(b){totaraMultiSelectDialog("assignment","<h2>"+b+"</h2>",a+"find_competency.php?templateid="+d,a+"save_competency.php?templateid="+d+"&deleteexisting=1&add=")})}),window.dialogsInited?e.resolve():(a.isArray(window.dialoginits)||(window.dialoginits=[]),window.dialoginits.push(e.resolve))}}});