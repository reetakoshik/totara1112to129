define(["core/templates"],function(a){function b(a){if(this.element=a,this.alwaysOpen="false"!==this.element.getAttribute("data-always-open"),this.allowMultiple="true"===this.element.getAttribute("data-allow-multiple"),this.alwaysOpen){var b=this.getOpenChildren();0===b.length&&this.toggleItem(this.getChildren()[0])}}function c(a){return new Promise(function(c){var d=new b(a);d.events(),c(d)})}return b.prototype.events=function(){var a=this,b=function(b){if(!b.target.closest("[data-accordion-noop]")){var c=b.target.closest(".totara_core__Accordion__item");c&&a.toggleItem(c)}};this.element.addEventListener("click",b),this.element.addEventListener("totara_core/accordion:open",function(b){var c=b.target.closest(".totara_core__Accordion__item"),d=b.originalEvent||b;a.toggleItem(c,!0,!!d.suppress)}),this.element.addEventListener("totara_core/accordion:close",function(b){var c=b.target.closest(".totara_core__Accordion__item"),d=b.originalEvent||b;a.toggleItem(c,!1,!!d.suppress)})},b.prototype.getChildren=function(){return this.element.querySelectorAll(".totara_core__Accordion__item")},b.prototype.getOpenChildren=function(){return this.element.querySelectorAll(".totara_core__Accordion__item:not(.collapsed)")},b.prototype.toggleItem=function(b,c,d){var e=!b.classList.contains("collapsed"),f=void 0===c?!e:c;if(!this.alwaysOpen||1!==this.getOpenChildren().length||!e){f&&!this.allowMultiple&&this.closeAllItems(),f?b.classList.remove("collapsed"):b.classList.add("collapsed"),b.querySelector(".totara_core__Accordion__item__header").setAttribute("aria-expanded",f);var g=f?"totara_core|accordion-expanded":"totara_core|accordion-collapsed";a.renderIcon(g).then(function(a){b.querySelector(".totara_core__Accordion__item__header__icon").innerHTML=a}),d||(f?b.dispatchEvent(new CustomEvent("totara_core/accordion:opened",{bubbles:!0,detail:{elem:b}})):b.dispatchEvent(new CustomEvent("totara_core/accordion:closed",{bubbles:!0,detail:{elem:b}})))}},b.prototype.closeAllItems=function(){for(var b=this.getChildren(),c=0;c<b.length;c++){var d=b.item(c);d.classList.add("collapsed"),d.querySelector(".totara_core__Accordion__item__header").setAttribute("aria-expanded",!1)}a.renderIcon("totara_core|accordion-collapsed").then(function(a){for(var c=0;c<b.length;c++){var d=b.item(c);d.classList.contains("collapsed")&&(d.querySelector(".totara_core__Accordion__item__header__icon").innerHTML=a)}})},{init:c}});