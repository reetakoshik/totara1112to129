define([],function(){function a(){return this instanceof a?(this.activeClass="tw-selectMulti__link_active",this.activeSelector="data-tw-selector-active",this.clearSelector="data-tw-selectorgroup-clear",this.hideClass="tw-selectMulti__hidden",this.key="",void(this.widget="")):new a}a.prototype={constructor:a,add:function(a){var b=a.getAttribute("data-tw-selectMulti-optionKey"),c=a.querySelector("[data-tw-selectMulti-close]");a.classList.add(this.activeClass),a.setAttribute(this.activeSelector,!0),a.setAttribute("aria-selected",!0),c.classList.remove(this.hideClass),this.triggerEvent("add",{groupValues:this.getAllSelectedValues(),key:this.key,val:b})},clear:function(){for(var a=this.widget.querySelectorAll("["+this.activeSelector+"]"),b=0;b<a.length;b++)this.remove(a[b])},events:function(){var a=this;this.widget.addEventListener("click",function(b){if(b.preventDefault(),b.target&&b.target.closest("[data-tw-selectMulti-optionKey]")){var c=b.target.closest("[data-tw-selectMulti-optionKey]");c.getAttribute(a.activeSelector)?a.remove(c):a.add(c),a.triggerEvent("changed",{})}});var b=new MutationObserver(function(){"true"===a.widget.getAttribute(a.clearSelector)&&(a.clear(),a.widget.setAttribute(a.clearSelector,!1))});b.observe(this.widget,{attributes:!0,attributeFilter:[a.clearSelector],subtree:!1})},getAllSelectedValues:function(){for(var a,b=this.widget.querySelectorAll("["+this.activeSelector+"]"),c=[],d=0;d<b.length;d++)a=b[d].getAttribute("data-tw-selectMulti-optionKey"),c.push(a);return c},preset:function(){for(var a=this.widget.querySelectorAll("["+this.activeSelector+"]"),b=0;b<a.length;b++)this.triggerEvent("add",{groupValues:this.getAllSelectedValues(),key:this.key,val:a[b].getAttribute("data-tw-selectMulti-optionKey")})},remove:function(a){var b=a.getAttribute("data-tw-selectMulti-optionKey"),c=a.querySelector("[data-tw-selectMulti-close]");a.removeAttribute(this.activeSelector),a.setAttribute("aria-selected",!1),a.classList.remove(this.activeClass),c.classList.add(this.hideClass),this.triggerEvent("remove",{groupValues:this.getAllSelectedValues(),key:this.key,val:b})},setParent:function(a){this.widget=a},setWidgetKey:function(){this.key=this.widget.getAttribute("data-tw-selectMulti-key")},triggerEvent:function(a,b){var c=new CustomEvent("totara_core/select_multi:"+a,{bubbles:!0,detail:b});this.widget.dispatchEvent(c)}};var b=function(b){return new Promise(function(c){var d=new a;d.setParent(b),d.setWidgetKey(),d.preset(),d.events(),c(d)})};return{init:b}});