define([],function(){function a(){return this instanceof a?(this.activeSelector="data-tw-selector-active",this.clearNode="",this.clearSelector="data-tw-selectorgroup-clear",this.hideClass="tw-selectRegionPanel__content_hidden",void(this.widget="")):new a}a.prototype={bubbledEventsListener:function(){var a="totara_core/select_multi",b="totara_core/select_search_text",c="totara_core/select_tree",d=this;this.widget.addEventListener(a+":add",function(a){d.triggerEvent("add",a.detail)}),this.widget.addEventListener(b+":add",function(a){d.triggerEvent("add",a.detail)}),this.widget.addEventListener(c+":add",function(a){d.triggerEvent("add",a.detail)}),this.widget.addEventListener(a+":changed",function(){d.regionChange()}),this.widget.addEventListener(b+":changed",function(){d.regionChange()}),this.widget.addEventListener(c+":changed",function(){d.regionChange()}),this.widget.addEventListener(a+":remove",function(a){d.triggerEvent("remove",a.detail)}),this.widget.addEventListener(b+":remove",function(a){d.triggerEvent("remove",a.detail)}),this.widget.addEventListener(c+":remove",function(a){d.triggerEvent("remove",a.detail)})},clear:function(){var a=this.widget.querySelectorAll("["+this.activeSelector+"]"),b=this;if(a){var c=new MutationObserver(function(){var a=b.widget.querySelectorAll("["+b.clearSelector+"=true]").length;a||(this.disconnect(),b.regionChange())});c.observe(this.widget,{attributes:!0,attributeFilter:[b.clearSelector],subtree:!0});for(var d=0;d<a.length;d++){var e=a[d].closest("[data-tw-selectorgroup]"),f=e.getAttribute(this.clearSelector);f&&"false"!==f||e.setAttribute(this.clearSelector,!0)}}},events:function(){var a=this;this.widget.addEventListener("click",function(b){b.preventDefault(),b.target&&b.target.closest("[data-tw-selectRegionPanel-clear]")&&a.clear()})},regionChange:function(){this.updateActiveCount(),this.triggerEvent("changed",{})},updateActiveCount:function(){var a=this.widget.querySelectorAll("["+this.activeSelector+"]").length,b=this.widget.querySelector("[data-tw-selectRegionPanel-clear]"),c=this.widget.querySelector("[data-tw-selectRegionPanel-count]");b&&(a>0?b.classList.remove(this.hideClass):b.classList.add(this.hideClass)),c&&(c.innerHTML=a,a>0?c.parentNode.classList.remove(this.hideClass):c.parentNode.classList.add(this.hideClass))},setParent:function(a){this.widget=a},triggerEvent:function(a,b){var c=new CustomEvent("totara_core/select_region_panel:"+a,{bubbles:!0,detail:b});this.widget.dispatchEvent(c)}};var b=function(b){return new Promise(function(c){var d=new a;d.setParent(b),d.bubbledEventsListener(),d.events(),d.updateActiveCount(),c(d)})};return{init:b}});