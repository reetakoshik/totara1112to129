define([],function(){function a(){return this instanceof a?(this.activeSelector="data-tw-selector-active",this.clearSelector="data-tw-selectorgroup-clear",this.hideClass="tw-selectSearchText__hidden",this.searchTerm="",void(this.widget="")):new a}a.prototype={constructor:a,add:function(a){var b=this.widget.querySelector("[data-tw-selectSearchText-urlkey]"),c=b.getAttribute("data-tw-selectSearchText-urlkey"),d=b.parentNode.querySelector("[data-tw-selectSearchText-clear]");this.setSearchTerm(a),b.setAttribute(this.activeSelector,!0),d.classList.remove(this.hideClass),this.triggerEvent("add",{key:c,val:a})},clear:function(){var a=this.widget.querySelector("[data-tw-selectSearchText-urlkey]"),b=a.getAttribute("data-tw-selectSearchText-urlkey"),c=a.parentNode.querySelector("[data-tw-selectSearchText-clear]");this.setSearchTerm(""),a.removeAttribute(this.activeSelector),c.classList.add(this.hideClass),a.value="",this.triggerEvent("remove",{key:b,val:""})},events:function(){var a=this;this.widget.addEventListener("click",function(b){b.preventDefault(),b.target&&(b.target.closest("[data-tw-selectSearchText-trigger]")?a.valueCheck():b.target.closest("[data-tw-selectSearchText-clear]")&&(a.clear(),a.triggerEvent("changed",{})))}),this.widget.addEventListener("keydown",function(b){b.target.closest("[data-tw-selectSearchText-urlkey]")&&("Enter"!==b.key&&13!==b.which&&13!==b.keyCode||(b.preventDefault(),a.valueCheck()))});var b=new MutationObserver(function(){"true"===a.widget.getAttribute(a.clearSelector)&&(a.clear(),a.widget.setAttribute(a.clearSelector,!1))});b.observe(this.widget,{attributes:!0,attributeFilter:[a.clearSelector],subtree:!1})},preset:function(){var a=this.widget.querySelector("[data-tw-selectSearchText-urlkey]"),b=a.value;if(""===b&&a.getAttribute(this.activeSelector)===!0)this.clear(),this.triggerEvent("changed",{});else{if(""===b)return;this.setSearchTerm(b),this.add(b)}},setParent:function(a){this.widget=a},setSearchTerm:function(a){this.searchTerm=a},triggerEvent:function(a,b){var c=new CustomEvent("totara_core/select_search_text:"+a,{bubbles:!0,detail:b});this.widget.dispatchEvent(c)},valueCheck:function(){var a=this.widget.querySelector("[data-tw-selectSearchText-urlkey]").value;this.searchTerm!==a&&(""===a?this.clear():this.add(a),this.triggerEvent("changed",{}))}};var b=function(b){return new Promise(function(c){var d=new a;d.setParent(b),d.preset(),d.events(),c(d)})};return{init:b}});