define(["core/templates","core/str","core/ajax"],function(a,b,c){function d(a){this.element=a}function e(a){return new Promise(function(b){var c=new d(a);c.events(),b(c)})}return d.prototype.events=function(){function c(a){var c=a.detail.elem,d=a.detail.text;c.closest("[data-quickaccesssettings-item-key]")?(h.save("totara_core_quickaccessmenu_rename_item",{key:c.closest("[data-quickaccesssettings-item-key]").getAttribute("data-quickaccesssettings-item-key"),label:d}).fail(function(){window.location.reload()}),b.get_string("quickaccesssettings:itemlabel","totara_core").done(function(a){c.setAttribute("aria-label",a+" "+d)})):c.closest("[data-quickaccesssettings-group-key]")&&h.save("totara_core_quickaccessmenu_rename_group",{groupkey:c.closest("[data-quickaccesssettings-group-key]").getAttribute("data-quickaccesssettings-group-key"),groupname:d}).fail(function(){window.location.reload()})}function d(b){var c=b.detail,d=c.val,e=b.target.closest(".totara_core__QuickAccessSettings__group"),f=e.getAttribute("data-quickaccesssettings-group-key");h.save("totara_core_quickaccessmenu_add_item",{key:d,group:f}).done(function(b){a.render("totara_core/quickaccesssettings_item",b).done(function(b){var c=h.element.querySelector('[data-quickaccesssettings-item-key="'+d+'"]');c&&c.closest(".totara_core__QuickAccessSettings__item").remove();var f=e.querySelector(".totara_core__QuickAccessSettings__item-list");f.insertAdjacentHTML("beforeend",b),a.runTemplateJS()})}).fail(function(a){window.location.reload()});var g=new CustomEvent("totara_core/select_tree:set-active",{bubbles:!1});c.widget.dispatchEvent(g),c.widget.setAttribute("data-tw-selectorgroup-clear",!0)}function e(){h.save("totara_core_quickaccessmenu_add_group",{groupname:""}).done(function(b){a.render("totara_core/quickaccesssettings_group",b).done(function(b){var c=h.element.querySelector(".totara_core__QuickAccessSettings__group-list");c.insertAdjacentHTML("beforeend",b),a.runTemplateJS()})}).fail(function(){window.location.reload()})}var f,g,h=this;for(this.element.addEventListener("click",function(a){var b=a.target.closest("[data-quickaccesssettings-group-key]"),c=a.target.closest("[data-quickaccesssettings-item-key]"),d="";if(c){if(d=a.target.closest("[data-quickaccesssettings-item-action]"),null!==d)switch(d=d.getAttribute("data-quickaccesssettings-item-action")){case"moveup":j(c.previousElementSibling,c),a.preventDefault(),a.stopPropagation();break;case"movedown":j(c,c.nextElementSibling),a.preventDefault(),a.stopPropagation();break;case"delete":a.preventDefault(),a.stopPropagation(),h.save("totara_core_quickaccessmenu_remove_item",{key:c.getAttribute("data-quickaccesssettings-item-key")}).done(function(){c.remove()}).fail(function(){window.location.reload()})}}else if(b){if(d=a.target.closest("[data-quickaccesssettings-group-action]"),null!==d)switch(b.dispatchEvent(new CustomEvent("totara_core/accordion:close",{bubbles:!0})),d=d.getAttribute("data-quickaccesssettings-group-action")){case"moveup":i(b.previousElementSibling,b),a.preventDefault(),a.stopPropagation();break;case"movedown":i(b,b.nextElementSibling),a.preventDefault(),a.stopPropagation();break;case"delete":a.preventDefault(),h.save("totara_core_quickaccessmenu_remove_group",{groupkey:b.getAttribute("data-quickaccesssettings-group-key")}).done(function(){b.remove()}).fail(function(){window.location.reload()})}}else;},!0),this.element.addEventListener("totara_core/inline-edit:save",c),this.element.addEventListener("totara_core/select_tree:add",d),f=this.element.querySelectorAll("[data-quickaccesssettings-addgroup]"),g=0;g<f.length;g++)f.item(g).addEventListener("click",e);var i=function(a,b){if(a&&b){var c=b.getAttribute("data-quickaccesssettings-group-key"),d=a.getAttribute("data-quickaccesssettings-group-key");h.save("totara_core_quickaccessmenu_move_group_before",{key:c,beforekey:d}).done(function(){b.classList.add("totara_core__QuickAccessSettings__item-swap-up"),a.classList.add("totara_core__QuickAccessSettings__item-swap-down"),M.util.js_pending("totara_core-quickaccesssettings-reorder-item-swap-up"),setTimeout(function(){b.classList.remove("totara_core__QuickAccessSettings__item-swap-up"),a.classList.remove("totara_core__QuickAccessSettings__item-swap-down"),a.parentNode.insertBefore(b,a),M.util.js_complete("totara_core-quickaccesssettings-reorder-item-swap-up")},200)}).fail(function(){window.location.reload()})}},j=function(a,b){if(a&&b){var c=b.getAttribute("data-quickaccesssettings-item-key"),d=a.getAttribute("data-quickaccesssettings-item-key");h.save("totara_core_quickaccessmenu_move_item_before",{key:c,beforekey:d}).done(function(){b.classList.add("totara_core__QuickAccessSettings__item-swap-up"),a.classList.add("totara_core__QuickAccessSettings__item-swap-down"),M.util.js_pending("totara_core-quickaccesssettings-reorder-item-up"),setTimeout(function(){b.classList.remove("totara_core__QuickAccessSettings__item-swap-up"),a.classList.remove("totara_core__QuickAccessSettings__item-swap-down"),a.parentNode.insertBefore(b,a),M.util.js_complete("totara_core-quickaccesssettings-reorder-item-up")},200)}).fail(function(){window.location.reload()})}}},d.prototype.save=function(a,b){b.userid=0;var d=c.call([{methodname:a,args:b}])[0];return M.util.js_pending("totara_core-quickaccesssettings-save"),d.always(function(){M.util.js_complete("totara_core-quickaccesssettings-save")}),d},{init:e}});