define(["core/templates"],function(a){function b(){return this instanceof b?(this.widget="",void(this.itemExpandedClass="totaraNav--list_item_expanded")):new b}b.prototype={constructor:b,events:function(){var a=this;this.widget.addEventListener("click",function(b){if(b.target){if(b.target.closest("[data-tw-totaraNav-toggle]")||b.target.closest("[data-tw-totaranav-list-close]"))return a.widget.querySelector("[data-tw-totaraNav-list]").classList.toggle("totaraNav_prim--list_showMobile"),a.widget.querySelector("[data-tw-totaraNav-list]").classList.toggle("totaraNav_prim--list_hideMobile"),void(b.target.closest("[data-tw-totaraNav-toggle]")&&a.widget.querySelector("[data-tw-totaranav-list-close]").focus());var c=b.target.closest("li");if(c&&c.hasAttribute("data-tw-totaraNav-hasChildren")){b.preventDefault();var d=c.classList.contains(a.itemExpandedClass);if(d)return void a.toggleExpandedList(c);var e=c.parentNode.closest("[data-tw-totaraNav-hasChildren]"),f=e?e:"";a.closeAllExpandedLists(f),a.toggleExpandedList(c)}}});for(var b=this.widget.querySelectorAll("[data-tw-totaranav-toplevelitem]"),c=0;c<b.length;c++)b[c].addEventListener("mouseenter",function(){var b=document.activeElement;b.classList.contains("totaraNav_prim--list_item_link")&&!b.parentNode.classList.contains(a.itemExpandedClass)&&b.blur()});this.widget.addEventListener("mouseleave",function(){var b=document.activeElement;b.closest("[data-tw-totaranav-item]")&&a.closeAllExpandedLists()}),window.innerWidth>991?(this.widget.addEventListener("keydown",function(b){if(b.target&&b.target.closest("[data-tw-totaraNav-item]")){var c=b.target.closest("[data-tw-totaraNav-item]"),d=b.target.closest("[data-tw-navExpand-list]");switch(b.key){case"ArrowDown":case"Down":b.preventDefault(),a.listItemKeyDown(c,d);break;case"ArrowLeft":case"Left":b.preventDefault(),a.listItemKeyLeft(c,d);break;case"ArrowRight":case"Right":b.preventDefault(),a.listItemKeyRight(c,d);break;case"ArrowUp":case"Up":b.preventDefault(),a.listItemKeyUp(c,d);break;case"Escape":case"Esc":a.listItemKeyEsc(c,d);break;case"Tab":b.shiftKey?a.listItemKeyTabBack(c):a.listItemKeyTab(c,d);break;case" ":case"Spacebar":b.preventDefault(),a.listItemKeySpace(c)}}}),window.addEventListener("click",function(b){b.target.closest("[data-tw-totaranav-item]")||a.closeAllExpandedLists()})):window.addEventListener("click",function(b){b.target.closest("[data-tw-totaraNav-list]")||b.target.closest("[data-tw-totaraNav-toggle]")||(a.widget.querySelector("[data-tw-totaraNav-list]").classList.remove("totaraNav_prim--list_showMobile"),a.widget.querySelector("[data-tw-totaraNav-list]").classList.add("totaraNav_prim--list_hideMobile"))}),window.addEventListener("resize",function(){var b=function(){c=null;for(var b=a.widget.querySelector("[data-tw-totaraNav-list]"),d=a.widget.querySelectorAll(".totaraNav--icon_chevron"),e=0;e<d.length;e++)d[e].remove();window.innerWidth>991?(a.addExpandableIcons(),b.classList.remove("totaraNav_prim--list_hideMobile","totaraNav_prim--list_showMobile")):(a.addExpandableIcons(),b.classList.contains("totaraNav_prim--list_showMobile")||b.classList.add("totaraNav_prim--list_hideMobile"))};if(M.cfg.behatsiterunning)return void b();var c;c||(c=setTimeout(b,66))})},addExpandableIcons:function(){for(var a=this.widget.querySelectorAll("[data-tw-totaraNav-chevron]"),b=0;b<a.length;b++)this.toggleExpandableIcon(a[b].parentNode)},closeExpandedList:function(a){var b=a.querySelector("[aria-expanded]");a.classList.remove(this.itemExpandedClass),b.setAttribute("aria-expanded",!1),this.toggleExpandableIcon(b)},closeAllExpandedLists:function(a){for(var b=this.widget.querySelectorAll("."+this.itemExpandedClass),c=0;c<b.length;c++)a!==b[c]&&this.closeExpandedList(b[c])},listItemKeyDown:function(a,b){if(a.classList.contains(this.itemExpandedClass)){var c=a.querySelectorAll("[data-tw-navExpand-list]")[0];c.querySelectorAll("a")[0].focus()}else b&&a.nextElementSibling&&a.nextElementSibling.querySelector("a").focus()},listItemKeyEsc:function(a,b){if(b){var c=a.closest("."+this.itemExpandedClass);this.closeExpandedList(c),c.querySelector("a").focus()}},listItemKeyLeft:function(a,b){!b&&a.previousElementSibling&&(this.closeAllExpandedLists(),a.previousElementSibling.querySelector("a").focus())},listItemKeyRight:function(a,b){!b&&a.nextElementSibling&&(this.closeAllExpandedLists(),a.nextElementSibling.querySelector("a").focus())},listItemKeySpace:function(a){a.hasAttribute("data-tw-totaraNav-hasChildren")&&this.toggleExpandedList(a.closest("[data-tw-totaraNav-hasChildren]"))},listItemKeyTab:function(a,b){if(b&&!a.nextElementSibling&&!a.classList.contains(this.itemExpandedClass)){var c=a.parentNode.closest("[data-tw-totaranav-item]"),d=c.nextElementSibling,e=!c.parentNode.closest("[data-tw-totaranav-item]"),f=a.parentNode.closest("[data-tw-totaranav-toplevelitem]");!d||e?this.closeAllExpandedLists(""):d&&this.closeAllExpandedLists(f)}},listItemKeyTabBack:function(a){var b=a.classList.contains(this.itemExpandedClass);b&&this.closeExpandedList(a)},listItemKeyUp:function(a,b){b&&a.previousElementSibling?a.previousElementSibling.querySelector("a").focus():b&&!a.previousElementSibling&&(b.previousElementSibling.focus(),this.closeExpandedList(b.parentNode))},toggleExpandedList:function(a){a.classList.toggle(this.itemExpandedClass);var b=!!a.classList.contains(this.itemExpandedClass),c=a.querySelector("[aria-expanded]");c.setAttribute("aria-expanded",b),c.focus(),this.toggleExpandableIcon(c)},setParent:function(a){this.widget=a},toggleExpandableIcon:function(b){var c,d=b.querySelector("[data-tw-totaraNav-chevron]"),e=b.closest("[data-tw-totaraNav-topLevelItem]"),f=b.parentNode.hasAttribute("data-tw-totaraNav-topLevelItem");if(d.hasChildNodes()&&(c=d.querySelector("[data-flex-icon]").getAttribute("data-flex-icon")),f&&window.innerWidth>991||!e){if(c)return;c="nav-down"}else c="nav-expand"===c?"nav-expanded":"nav-expand";a.renderIcon(c,"","totaraNav--icon_chevron").done(function(a){d.innerHTML=a})}};var c=function(a){var c=new b;c.setParent(a),c.events(),c.addExpandableIcons()};return{init:c}});