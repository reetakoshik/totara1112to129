define(["core/str","totara_form/form"],function(a,b){var c=null,d="data-totara_catalog--dirty",e=function(f,g){var h="totaraCatalogAdminFormInit"+f,i="tf_fid_"+f;M.util.js_pending(h);var j=new Promise(function(b){a.get_string("discard_unsaved_changes","totara_catalog").then(b)}).then(function(a){null===c&&(c=function(b){var c=document.getElementById(i);if("true"===c.getAttribute(d))return b.preventDefault(),b.returnValue=a,a},window.addEventListener("beforeunload",c))}),k=new Promise(function(a,c){var d=b.getFormInstance(i);if(null===d||g){var e=document.getElementById(i);null===e&&c();var f=function(){"true"===e.getAttribute("data-totara_form-initialised")&&(h.disconnect(),a(b.getFormInstance(i)))},h=new MutationObserver(f);h.observe(e,{attributes:!0,attributeFilter:["data-totara_form-initialised"]})}else a(d)}).then(function(a){var b=a.form[0],c=b.querySelector('[data-name="submitbutton"], [name="submitbutton"]'),i=b.querySelector('[data-name="cancelbutton"], [name="cancelbutton"]'),j=function(){b.removeAttribute(d)},k=function(){b.setAttribute(d,"true")};g&&k(),c.addEventListener("click",j),i.addEventListener("click",j),a._parentValueChanged=a.valueChanged,a.valueChanged=function(b,d){var e=a.form[0].parentElement.querySelectorAll(".alert"),f=0;for(f=0;f<e.length;f++)e[f].remove();c.removeAttribute("disabled"),c.setAttribute("name",c.getAttribute("data-name")),c.closest('[data-item-classification="element"]').setAttribute("data-element-frozen","0"),i.removeAttribute("disabled"),i.setAttribute("name",i.getAttribute("data-name")),i.closest('[data-item-classification="element"]').setAttribute("data-element-frozen","0"),k(),this._parentValueChanged(b,d)},a._parentReload=a.reload,a.reload=function(a){var c=f;M.util.js_pending(h+"_reload"),this.ajaxSubmit(a,!0).then(function(){var a=b.parentElement,d=function(){e(c,!0),f.disconnect(),M.util.js_complete(h+"_reload")},f=new MutationObserver(d);f.observe(a,{childList:!0})})}});Promise.all([j,k]).then(function(){M.util.js_complete(h)})};return{init:e}});