define(["totara_form/form","core/templates"],function(a,b){function c(b,d,e,f){return this instanceof c?(a.Element.apply(this,arguments),this.input=document.getElementById(e),this.id=e,this.parent=b,this.node=f,this.potentialfilters={},void(this.name=this.input.getAttribute("data-name"))):new c(b,d,e,f)}return c.prototype=Object.create(a.Element.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return"[object Matrix]"},c.prototype.init=function(a){var b=this.input.getElementsByClassName("totara_catalog-matrix__addfilter")[0].options,c=0;for(c=1;c<b.length;c++)this.potentialfilters[b[c].value]=b[c].label,this.input.querySelectorAll("[data-id="+b[c].value+"]").length>0&&(b[c].classList.add("totara_form_option_invisible"),b[c].disabled=!0);this.input.getElementsByClassName("totara_catalog-matrix__addfilter")[0].addEventListener("change",this._addItem.bind(this)),this.input.addEventListener("click",this._changeItem.bind(this)),this.input.addEventListener("change",this.changed.bind(this)),a()},c.prototype.getValue=function(){var a,b=this.input.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),c=[];for(a=0;a<b.length;a++)c.push({id:b[a].getAttribute("data-id"),name:b[a].getElementsByTagName("input")[0].value});return c},c.prototype._addItem=function(a){if(""!==a.target.value){var c=this,d={id:a.target.value,filtername:this.potentialfilters[a.target.value],heading:this.potentialfilters[a.target.value],name:this.name},e=a.target;b.render("totara_catalog/element_matrix__row",d).done(function(a){c.input.querySelector("#"+c.id+"_table tbody").insertAdjacentHTML("beforeend",a),e.options[e.selectedIndex].classList.add("totara_form_option_invisible"),e.options[e.selectedIndex].disabled=!0,e.selectedIndex=0,c.changed()})}},c.prototype._changeItem=function(a){var b=a.target.closest("tr"),c=a.target.closest("[data-action]");if(c){switch(a.preventDefault(),c.getAttribute("data-action")){case"delete":var d,e=this.input.getElementsByClassName("totara_catalog-matrix__addfilter")[0];d=e.querySelector("option[value="+b.getAttribute("data-id")+"]"),d.classList.remove("totara_form_option_invisible"),d.disabled=!1,b.remove();break;case"move-up":null!==b.previousElementSibling&&b.parentElement.insertBefore(b,b.previousElementSibling);break;case"move-down":null!==b.nextElementSibling&&b.nextElementSibling.insertAdjacentElement("afterend",b)}this.changed()}},c});