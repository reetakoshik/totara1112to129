define(["totara_form/form","core/templates"],function(a,b){function c(b,d,e,f){return this instanceof c?(a.Element.apply(this,arguments),this.input=document.getElementById(e),this.id=e,this.parent=b,this.node=f,this.addSelector=this.input.getElementsByClassName("totara_catalog-multiple_select__addicon")[0],void(this.name=this.input.getAttribute("data-name"))):new c(b,d,e,f)}return c.prototype=Object.create(a.Element.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return"[object multiSelect]"},c.prototype.init=function(a){var b=this.addSelector.options,c=0;for(c=1;c<b.length;c++)this.input.querySelectorAll("[data-id="+b[c].value+"]").length>0&&(b[c].classList.add("totara_form_option_invisible"),b[c].disabled=!0);this.addSelector.addEventListener("change",this._addItem.bind(this)),this.input.addEventListener("click",this._changeItem.bind(this)),this._checkempty(),a()},c.prototype.getValue=function(){var a,b=this.input.getElementsByTagName("ol")[0].getElementsByTagName("li"),c=[];for(a=0;a<b.length;a++)c.push(b[a].getAttribute("data-id"));return c},c.prototype._addItem=function(a){if(""!==a.target.value){var c=this,d=a.target,e=d.selectedIndex,f={id:d.value,iconname:d.options[e].text};b.render("totara_catalog/element_multiple_select__item",f).done(function(a){c.input.querySelector("#"+c.id+"_list").insertAdjacentHTML("beforeend",a),d.options[e].classList.add("totara_form_option_invisible"),d.options[e].disabled=!0,d.selectedIndex=0,c._changed()})}},c.prototype._changeItem=function(a){var b=a.target.closest("li"),c=a.target.closest("[data-action]");if(c){switch(a.preventDefault(),c.getAttribute("data-action")){case"delete":var d,e=this.input.getElementsByClassName("totara_catalog-multiple_select__addicon")[0];d=e.querySelector("option[value="+b.getAttribute("data-id")+"]"),d.classList.remove("totara_form_option_invisible"),d.disabled=!1,b.remove();break;case"move-up":null!==b.previousElementSibling&&b.parentElement.insertBefore(b,b.previousElementSibling);break;case"move-down":null!==b.nextElementSibling&&b.nextElementSibling.insertAdjacentElement("afterend",b)}this._changed()}},c.prototype._changed=function(){this.node.querySelector("[type=hidden]").value=JSON.stringify(this.getValue()),this._checkempty(),this.changed()},c.prototype._checkempty=function(){null===this.input.querySelector(".totara_catalog-multiple_select__selected li")?this.input.classList.add("totara_catalog-multiple_select__noitems"):this.input.classList.remove("totara_catalog-multiple_select__noitems")},c});