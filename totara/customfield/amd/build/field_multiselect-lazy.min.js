define(["jquery","core/str"],function(a,b){return{init:function(c,d,e){var f=0,g=a("#fgroup_id"+d),h=g.find('div[id^="fgroup_id_multiselectitem_"]').slice(0,e);h.each(function(b){a(this).find("input[type='text']").each(function(c,d){if(""!==a(d).val())return f=b+1,!1})}),f<3&&(f=3),h.slice(f,e).hide(),h.each(function(){var d=a(this);if(a(d.find("span")).length>0){var e=[];e.push({key:"defaultmake",component:"totara_customfield"}),e.push({key:"defaultselected",component:"totara_customfield"}),e.push({key:"delete",component:"moodle"}),b.get_strings(e).done(function(b){var e=a('<a href="#" class="customfield-multiselect-action customfield-multiselect-selectlink">'+b[0]+"</a>"),f=a('<a href="#" class="customfield-multiselect-action customfield-multiselect-unselectlink">'+b[1]+"</a>").hide(),g=a('<a href="#" class="customfield-multiselect-action customfield-multiselect-deletelink">'+b[2]+"</a>");e.on("click",function(){return 1==c&&h.find(".customfield-multiselect-unselectlink").each(function(){a(this).click()}),d.find("input.makedefault").prop("checked",!0),e.hide(),f.show(),!1}),f.on("click",function(){return d.find("input.makedefault").prop("checked",!1),e.show(),f.hide(),!1}),g.on("click",function(){return d.find("input.delete").prop("checked",!0),d.addClass("customfield-multiselect-deleted"),d.hide(),!1}),d.append(e),d.append(f),d.append(g),d.find("input.makedefault").prop("checked")&&e.click()})}}),g.find("a.addoptionlink").show(),g.find("a.addoptionlink").on("click",function(){var b=g.find(".felement > div:hidden").not(".customfield-multiselect-deleted").eq(0);return b.length&&(b.show(),f++),f==e&&a(this).hide(),!1})}}});