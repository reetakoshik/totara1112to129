define(["jquery","core/config"],function(a,b){function c(b,c,d,e){this.context=null,this.filters={},this.marketplace=null,this.category=null,this.populated=a.Deferred(),this.mode=null,this.init(b,c,d,e)}return c.prototype.init=function(b,c,d,e,f){var g=this,h=[];this.context=a(b+" .tcm-search-filters-wrapper"),this.marketplace=d,this.mode=e,this.category=f,a(".tcm-search-filter",this.context).each(function(){var d=a(this).data("filter-name"),e=a(this).data("filter-module"),f=a(this).data("filter-showcounts");h.push(g.initFilter(d,e,f,b+" .tcm-search-filter-name-"+d,c))}),a.when.apply(a,h).done(function(){g.fetchFilterSeeds().done(function(a){g.populateFilters(a)})})},c.prototype.setCounts=function(b){var c=this;this.populated.done(function(){a.each(b,function(a,b){c.filters[b.name].setCounts(b.values)})})},c.prototype.getValues=function(){var a={};for(var b in this.filters)a[b]=this.filters[b].getValue();return a},c.prototype.initFilter=function(b,c,d,e,f){var g=this,h=a.Deferred();return require([c],function(a){var c=new a(b,d,e,f);g.filters[c.name]=c,h.resolve()}),h.promise()},c.prototype.populateFilters=function(b){var c=this,d=[];a.each(b,function(a,b){d.push(c.filters[b.name].populate(b))}),a.when.apply(a,d).done(function(){c.populated.resolve(),a(".tcm-search-filters-loading",c.context).hide(),a(".tcm-search-filters",c.context).show()})},c.prototype.fetchFilterSeeds=function(){var c={sesskey:b.sesskey,marketplace:this.marketplace,category:this.category,mode:this.mode};return a.post({url:b.wwwroot+"/totara/contentmarketplace/ajax/filters.php",data:c})},c});