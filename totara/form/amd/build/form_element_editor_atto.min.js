define(["jquery","core/yui","core/str","totara_form/form"],function($,Y,core_strings,Form){function AttoElement(a,b,c,d){return this instanceof AttoElement?(Form.Element.apply(this,arguments),this.input=null,void(this.editor=null)):new AttoElement(a,b,c,d)}return AttoElement.prototype=Object.create(Form.Element.prototype),AttoElement.constructor=AttoElement,AttoElement.prototype.toString=function(){return"[object AttoElement]"},AttoElement.prototype.init=function(a){M.util.js_pending("totara_form_element_editor_atto");var b=this;this.input=$("#"+this.id),window.totara_form_editors=window.totara_form_editors||{},window.totara_form_editors[this.id]=this;var c=this.input.data("fptemplates"),d=this.input.data("jsmodules"),e=this.input.data("requiredstrings"),f=this.input.data("yuimodules");Y.use(["core_filepicker","node","node-event-simulate","core_dndupload"],function(a){M.core_filepicker.set_templates(a,c)}),M.yui.add_module(d),Y.applyConfig(YUI_config),core_strings.get_strings(e).done(function(){for(var a=0;a<f.length;a++)b.initYUIModules(f[a])}),a()},AttoElement.prototype.initYUIModules=function(yuimodule){var self=this;Y.use(yuimodule.modules,function(){var result=eval(yuimodule.functionstr);result&&self.setEditor(result)})},AttoElement.prototype.setEditor=function(a){this.editor=a,a.on("change",$.proxy(this.changed,this))},AttoElement.prototype.getValue=function(){return this.editor&&this.editor.updateOriginal(),this.input.val().toString()},AttoElement.prototype.setValue=function(a){this.input.val(a),this.editor&&this.editor.updateFromTextArea(),Form.debug("Atto editor value changed programmatically",this,Form.LOGLEVEL.info),this.changed({})},AttoElement.prototype.compare=function(a){var b,c=this.getValue(),d=null;switch(a){case Form.Operators.Equals:if(2!==arguments.length)return Form.debug("Compare Equals expects 2 arguments, "+arguments.length+" given.",this,Form.LOGLEVEL.warn),null;if(b=arguments[1],Array.isArray(b))return!1;d=c.toString()===b.toString()||this.stripValue(c)===b.toString();break;case Form.Operators.Empty:d=null===c||c===!1||""===c.toString()||"0"===c.toString()||""===this.stripValue(c);break;case Form.Operators.Filled:d=null!==c&&""!==c&&""!==this.stripValue(c);break;case Form.Operators.NotEquals:if(2!==arguments.length)return Form.debug("Compare NotEquals expects 2 arguments, "+arguments.length+" given.",this,Form.LOGLEVEL.warn),null;b=arguments[1],d=!this.compare(Form.Operators.Equals,b);break;case Form.Operators.NotEmpty:d=!this.compare(Form.Operators.Empty);break;case Form.Operators.NotFilled:d=!this.compare(Form.Operators.Filled);break;default:Form.debug('Element does not implement all comparisons: "'+a+'", asking the Form',this,Form.LOGLEVEL.warn);var e=[c].concat(Array.prototype.slice.call(arguments));d=Form.prototype.compare.apply(null,e)}return d},AttoElement.prototype.stripValue=function(a){return a.trim().replace(/^<p[^>]*>(.*)<\/p>$/g,"$1").replace(/<br ?\/?>/g,"").replace("&nbsp;","").trim()},AttoElement.prototype.isEmpty=function(){var a=this.getValue();return""===a||"<p></p>"===a},AttoElement.prototype.getObjectClass=function(a){if(a&&a.constructor){if(a.constructor.name)return a.constructor.name;if(a.constructor.toString){var b=a.constructor.toString().match(/function\s*(\w + )/);if(b&&2==b.length)return b[1]}}},AttoElement});