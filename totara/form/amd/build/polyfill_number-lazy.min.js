define(["jquery"],function(a){var b={init:function(b){var c;c=function(b){var d,e,f,g,h=this;if(this.elem=a(b),!(this.elem.is(":root *")&&this.elem.height()>0))throw new Error("Element must be in DOM and displayed so that its height can be measured.");g=this.elem.outerHeight()/2+"px",this.upBtn=a("<div/>",{"class":"number-spin-btn number-spin-btn-up",style:"height: "+g}),this.downBtn=a("<div/>",{"class":"number-spin-btn number-spin-btn-down",style:"height: "+g}),this.btnContainer=a("<div/>",{"class":"number-spin-btn-container"}),d=a("<span/>",{style:"white-space: nowrap"}),this.upBtn.appendTo(this.btnContainer),this.downBtn.appendTo(this.btnContainer),this.elem.wrap(d),this.btnContainer.insertAfter(this.elem),this.elem.on({focus:function(a){h.elem.on({DOMMouseScroll:c.domMouseScrollHandler,mousewheel:c.mouseWheelHandler},{p:h})},blur:function(a){h.elem.off({DOMMouseScroll:c.domMouseScrollHandler,mousewheel:c.mouseWheelHandler})}}),this.elem.on({keypress:c.elemKeypressHandler,change:c.elemChangeHandler},{p:this}),this.upBtn.on("mousedown",{p:this,func:"increment"},c.elemBtnMousedownHandler),this.downBtn.on("mousedown",{p:this,func:"decrement"},c.elemBtnMousedownHandler),this.elem.css("textAlign","right"),this.attrMutationHandler("class"),"undefined"!=typeof WebKitMutationObserver&&null!==WebKitMutationObserver||"undefined"!=typeof e&&null!==e?("undefined"==typeof WebKitMutationObserver||null===WebKitMutationObserver||"undefined"!=typeof e&&null!==e||(e=WebKitMutationObserver),f=new e(function(a,b){var c,d,e;for(d=0,e=a.length;d<e;d++)c=a[d],"attributes"===c.type&&h.attrMutationHandler(c.attributeName,c.oldValue,h.elem.attr(c.attributeName))}),f.observe(b,{attributes:!0,attributeOldValue:!0,attributeFilter:["class","style","min","max","step"]})):"undefined"!=typeof MutationEvent&&null!==MutationEvent&&this.elem.on("DOMAttrModified",function(a){h.attrMutationHandler(a.originalEvent.attrName,a.originalEvent.prevValue,a.originalEvent.newValue)})},c.polyfills=[],c.isNumber=function(a){return null!=a&&"function"==typeof a.toString&&/^-?\d+(?:\.\d+)?$/.test(a.toString())},c.isFloat=function(a){return null!=a&&"function"==typeof a.toString&&/^-?\d+\.\d+$/.test(a.toString())},c.isInt=function(a){return null!=a&&"function"==typeof a.toString&&/^-?\d+$/.test(a.toString())},c.isNegative=function(a){return null!=a&&"function"==typeof a.toString&&/^-\d+(?:\.\d+)?$/.test(a.toString())},c.raiseNum=function(a){var b,d,e;if("number"==typeof a||"object"==typeof a&&a instanceof Number)return a%1?{num:a.toString(),precision:0}:c.raiseNum(a.toString());if("string"==typeof a||"object"==typeof a&&a instanceof String){if(c.isFloat(a))return a=a.replace(/(\.\d)0+$/,"$1"),e=c.getPrecision(a),d=a.slice(0,-(e+1))+a.slice(-e),d=d.replace(/^(-?)0+(\d+)/,"$1$2"),b={num:d,precision:e};if(c.isInt(a))return{num:a,precision:0}}},c.raiseNumPrecision=function(a,b){var c,d;if(a.precision<b){for(i=c=d=a.precision;d<=b?c<b:c>b;i=d<=b?++c:--c)a.num+="0";a.precision=b}},c.lowerNum=function(a){if(a.precision>0){for(;a.num.length<a.precision+1;)c.isNegative(a.num)?a.num=a.num.slice(0,1)+"0"+a.num.slice(1):a.num="0"+a.num;return(a.num.slice(0,-a.precision)+"."+a.num.slice(-a.precision)).replace(/\.?0+$/,"").replace(/^(-?)(\.)/,"$10$2")}return a.num},c.preciseAdd=function(a,b){var d,e,f;if(("number"==typeof a||"object"==typeof a&&a instanceof Number)&&("number"==typeof b||"object"==typeof b&&b instanceof Number))return a%1===0&&b%1===0?(a+b).toString():c.preciseAdd(a.toString(),b.toString());if(("string"==typeof a||"object"==typeof a&&a instanceof String)&&("string"==typeof b||"object"==typeof b&&b instanceof String)){if(c.isNumber(a)){if(c.isNumber(b)){if(c.isInt(a)){if(c.isInt(b))return c.preciseAdd(parseInt(a,10),parseInt(b,10));c.isFloat(b)&&(a+=".0")}else c.isFloat(a)&&c.isInt(b)&&(b+=".0");if(d=c.raiseNum(a),e=c.raiseNum(b),d.precision<e.precision?c.raiseNumPrecision(d,e.precision):d.precision>e.precision&&c.raiseNumPrecision(e,d.precision),f=(parseInt(d.num,10)+parseInt(e.num,10)).toString(),d.precision>0){if(c.isNegative(f))for(;d.precision>f.length-1;)f="-0"+f.slice(1);else for(;d.precision>f.length;)f="0"+f;f=c.lowerNum({num:f,precision:d.precision})}return f=f.replace(/^(-?)\./,"$10."),c.isFloat(f)&&(f=f.replace(/0+$/,"")),f}throw new SyntaxError('Argument "'+b+'" is not a number.')}throw new SyntaxError('Argument "'+a+'" is not a number.')}return c.preciseAdd(a.toString(),b.toString())},c.preciseSubtract=function(a,b){return"number"==typeof b||"object"==typeof b&&b instanceof Number?c.preciseAdd(a,-b):"string"==typeof b||"object"==typeof b&&b instanceof String?c.isNegative(b)?c.preciseAdd(a,b.slice(1)):c.preciseAdd(a,"-"+b):void 0},c.getPrecision=function(a){var b,d;if("number"==typeof a){for(b=0,d=a;d!==Math.floor(d);)d=a*Math.pow(10,++b);return b}if("string"==typeof a&&c.isNumber(a))return c.isFloat(a)?/^-?\d+(?:\.(\d+))?$/.exec(a)[1].length:0},c.prototype.getParams=function(){var a,b,d,e;return d=this.elem.attr("step"),b=this.elem.attr("min"),a=this.elem.attr("max"),e=this.elem.val(),c.isNumber(d)||(d=null),c.isNumber(b)||(b=null),c.isNumber(a)||(a=null),c.isNumber(e)||(e=b||0),{min:null!=b?b:null,max:null!=a?a:null,step:null!=d?d:"1",val:null!=e?e:null}},c.prototype.clipValues=function(a,b,c){return null!=c&&parseFloat(a)>parseFloat(c)?c:null!=b&&parseFloat(a)<parseFloat(b)?b:a},c.prototype.stepNormalize=function(a){var b,d,e,f,g;return e=this.getParams(),g=e.step,d=e.min,null==g?a:(g=c.raiseNum(g),b=c.raiseNum(a),b.precision>g.precision?c.raiseNumPrecision(g,b.precision):b.precision<g.precision&&c.raiseNumPrecision(b,g.precision),null!=d&&(b=c.raiseNum(c.preciseSubtract(a,d)),c.raiseNumPrecision(b,g.precision)),parseFloat(b.num)%parseFloat(g.num)===0?a:(b=c.lowerNum({num:(Math.round(parseFloat(b.num)/(f=parseFloat(g.num)))*f).toString(),precision:b.precision}),null!=d&&(b=c.preciseAdd(b,d)),b))},c.domMouseScrollHandler=function(a){var b;b=a.data.p,a.preventDefault(),a.originalEvent.detail<0?b.increment():b.decrement()},c.mouseWheelHandler=function(a){var b;b=a.data.p,a.preventDefault(),a.originalEvent.wheelDelta>0?b.increment():b.decrement()},c.elemKeypressHandler=function(a){var b,c,d;b=a.data.p,38===a.keyCode?b.increment():40===a.keyCode?b.decrement():8!==(c=a.keyCode)&&9!==c&&35!==c&&36!==c&&37!==c&&39!==c&&46!==c&&45!==(d=a.which)&&46!==d&&48!==d&&49!==d&&50!==d&&51!==d&&52!==d&&53!==d&&54!==d&&55!==d&&56!==d&&57!==d&&a.preventDefault()},c.elemChangeHandler=function(a){var b,d,e,f;e=a.data.p,""!==e.elem.val()&&(c.isNumber(e.elem.val())?(f=e.getParams(),d=e.clipValues(f.val,f.min,f.max),d=e.stepNormalize(d),d.toString()!==e.elem.val()&&e.elem.val(d).change()):(b=e.elem.attr("min"),e.elem.val(null!=b&&c.isNumber(b)?b:"0").change()))},c.elemBtnMousedownHandler=function(b){var c,d,e,f,g=this;d=b.data.p,c=b.data.func,d[c](),f=function(a){d[c](),d.timeoutID=window.setTimeout(f,10)},e=function(b){window.clearTimeout(d.timeoutID),a(document).off("mouseup",e),a(g).off("mouseleave",e)},a(document).on("mouseup",e),a(this).on("mouseleave",e),d.timeoutID=window.setTimeout(f,700)},c.prototype.attrMutationHandler=function(a,b,c){var d,e,f,g,h;if("class"===a||"style"===a){for(e={},d=null,h=["opacity","visibility","-moz-transition-property","-moz-transition-duration","-moz-transition-timing-function","-moz-transition-delay","-webkit-transition-property","-webkit-transition-duration","-webkit-transition-timing-function","-webkit-transition-delay","-o-transition-property","-o-transition-duration","-o-transition-timing-function","-o-transition-delay","transition-property","transition-duration","transition-timing-function","transition-delay"],f=0,g=h.length;f<g;f++)i=h[f],(d=this.elem.css(i))!==this.btnContainer.css(i)&&(e[i]=d);"none"===this.elem.css("display")?e.display="none":e.display="inline-block",this.btnContainer.css(e)}else"min"!==a&&"max"!==a&&"step"!==a||this.elem.change()},c.prototype.increment=function(){var a,b;this.elem.is(":disabled")||this.elem.is("[readonly]")||(b=this.getParams(),a=c.preciseAdd(b.val,b.step),null!=b.max&&parseFloat(a)>parseFloat(b.max)&&(a=b.max),a=this.stepNormalize(a),this.elem.val(a).change())},c.prototype.decrement=function(){var a,b;this.elem.is(":disabled")||this.elem.is("[readonly]")||(b=this.getParams(),a=c.preciseSubtract(b.val,b.step),null!=b.min&&parseFloat(a)<parseFloat(b.min)&&(a=b.min),a=this.stepNormalize(a),this.elem.val(a).change())},c.polyfills.push(new c(a("#"+b)))}};return b});