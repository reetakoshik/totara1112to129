define(["jquery","totara_form/form","totara_form/clientaction_base","core/notification","core/str"],function(a,b,c,d,e){var f="totara_form/form_clientaction_onchange_ajaxsubmit",g=function(a){var c="undefined"!=typeof arguments[1]?arguments[1]:b.LOGLEVEL.debug;b.debug(a,h,c)},h=function(){c.apply(this,arguments),this.initialValues=[],this.ajaxSubmitTimeoutID=0,this.ajaxSubmitFormCallback=a.proxy(this.ajaxSubmitForm,this),this.ignoredValues=arguments[0].ignoredvalues||[],this.submitHandler=arguments[0].submithandler||!1};return h=b.extend(c,h,{init:function(){var a=this.form.getElementById(this.actionconfig.target);return"undefined"==typeof a?void g("Unable to retrieve the element with id "+this.actionconfig.target,b.LOGLEVEL.error):(this.getWatchedIds().push(this.actionconfig.target),this.initialValues[this.actionconfig.target]=a.getValue(),void g("Registered onchange_ajaxsubmit client action for "+this.actionconfig.target))},checkState:function(){var a=!1;this.ajaxSubmitTimeoutID&&this.cancelAjaxSubmitForm(),this.getWatchedIds().forEach(function(c){if(a!==!0){g("Checking "+c+" for onchange_ajaxsubmit");var d,e=this.form.getElementById(c);if("undefined"==typeof e)return void g("Unable to retrieve the element with id "+this.actionconfig.target,b.LOGLEVEL.error);d=e.getValue();var f=function(a,b){var c;if(Array.isArray(a)&&Array.isArray(b)){if(a.length!==b.length)return!1;for(c=0;c<b.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b}(this.initialValues[c],d);f||(this.initialValues[c]=d,this.ignoredValues.indexOf(d.toString())===-1&&(e.showLoading(),a=!0))}},this),a&&(g("Onchange submit by ajax client action triggered for "+this.actionconfig.target),this.form.showLoading(),M.util.js_pending(f),this.ajaxSubmitTimeoutID=setTimeout(this.ajaxSubmitFormCallback,this.actionconfig.delay))},cancelAjaxSubmitForm:function(){g("Clearing onchange submit by ajax client action timeout for "+this.actionconfig.target),clearTimeout(this.ajaxSubmitTimeoutID),this.ajaxSubmitTimeoutID=0,M.util.js_complete(f)},ajaxSubmitForm:function(){g("Onchange submit by ajax client action occurring for "+this.actionconfig.target);var b=this.form.ajaxSubmit();this.submitHandler?this.submitHandler.apply(null,[this,b]):b.done(a.proxy(function(a,b){"submitted"===a?(g("Reloading the form to get an updated version after ajaxsubmit for "+this.actionconfig.target),this.form.reload()):e.get_strings([{key:"error",component:"error"},{key:"ok",component:"core"}]).done(function(a){d.alert(a[0],a[0],a[1])})},this)),b.done(function(){M.util.js_complete(f)}),this.ajaxSubmitTimeoutID=0},toString:function(){return"[object OnChangeAjaxSubmitAction]"}}),{init:function(a,b,c){var d=new h(a,b);d.init(),c(d)}}});