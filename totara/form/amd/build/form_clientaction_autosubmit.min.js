define(["totara_form/form","totara_form/clientaction_base","core/config"],function(a,b,c){var d=c.behatsiterunning?0:300,e=function(){b.apply(this,arguments),this.initialValues=[],this.submitTimeoutID=0};return e=a.extend(b,e,{init:function(){this.watchedIds.push(this.actionconfig.target);var b=this.form.elements[this.actionconfig.target].input.parent().append('<span class="tf_autosubmit_loading">');b.find(".tf_autosubmit_loading").hide(),require(["core/templates","core/str"],function(a,c){c.get_string("loading","core").then(function(b){return a.renderIcon("loading",{alt:b})}).then(function(a){b.find(".tf_autosubmit_loading").html(a)})}),this.initialValues[this.actionconfig.target]=this.form.elements[this.actionconfig.target].getValue(),a.debug("Registered Autosubmit for "+this.actionconfig.target+" comparisons",e,a.LOGLEVEL.debug)},checkState:function(){var b=!1;if(this.submitTimeoutID&&(a.debug("Clearing autosubmit timeout",e,a.LOGLEVEL.debug),clearTimeout(this.submitTimeoutID),this.submitTimeoutID=0),this.watchedIds.forEach(function(c){a.debug("Checking "+c+" for autosubmit",e,a.LOGLEVEL.debug),this.initialValues[c]!=this.form.elements[c].getValue()&&(this.initialValues[c]=this.form.elements[c].getValue(),this.form.elements[c].input.parent().find(".tf_autosubmit_loading").show(),b=!0)},this),b){a.debug("Autosubmit triggered",e,a.LOGLEVEL.debug);var c=this,f=function(){a.debug("Autosubmit occuring",e,a.LOGLEVEL.debug),c.form.ajaxSubmit().done(function(){c.watchedIds.forEach(function(a){c.form.elements[a].input.parent().find(".tf_autosubmit_loading").hide()})}),c.submitTimeoutID=0,window.removeEventListener("beforeunload",f)};this.submitTimeoutID=setTimeout(f,d),window.addEventListener("beforeunload",f)}}}),{init:function(a,b,c){var d=new e(a,b);d.init(),c(d)}}});