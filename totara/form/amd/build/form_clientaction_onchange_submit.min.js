define(["jquery","totara_form/form","totara_form/clientaction_base"],function(a,b,c){var d="totara_form/form_clientaction_onchange_submit",e=function(a){var c="undefined"!=typeof arguments[1]?arguments[1]:b.LOGLEVEL.debug;b.debug(a,f,c)},f=function(){c.apply(this,arguments),this.initialValues=[],this.submitTimeoutID=0,this.submitFormCallback=a.proxy(this.submitForm,this),this.ignoredValues=arguments[0].ignoredvalues||[]};return f=b.extend(c,f,{init:function(){var a=this.form.getElementById(this.actionconfig.target);return"undefined"==typeof a?void e("Unable to retrieve the element with id "+this.actionconfig.target,b.LOGLEVEL.error):(this.getWatchedIds().push(this.actionconfig.target),this.initialValues[this.actionconfig.target]=a.getValue(),void e("Registered onchange_submit client action for "+this.actionconfig.target))},checkState:function(){var c=!1;this.submitTimeoutID&&this.cancelSubmitForm(),this.getWatchedIds().forEach(function(a){if(c!==!0){e("Checking "+a+" for onchange_submit");var d,f=this.form.getElementById(a);if("undefined"==typeof f)return void e("Unable to retrieve the element with id "+this.actionconfig.target,b.LOGLEVEL.error);d=f.getValue();var g=function(a,b){var c;if(Array.isArray(a)&&Array.isArray(b)){if(a.length!==b.length)return!1;for(c=0;c<b.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b}(this.initialValues[a],d);g||(this.initialValues[a]=d,this.ignoredValues.indexOf(d.toString())===-1&&(f.showLoading(),c=!0))}},this),c&&(e("Onchange submit client action triggered for "+this.actionconfig.target),this.form.showLoading(),M.util.js_pending(d),this.submitTimeoutID=setTimeout(this.submitFormCallback,this.actionconfig.delay),a(window).on("beforeunload",this.submitFormCallback))},cancelSubmitForm:function(){e("Clearing onchange submit client action timeout for "+this.actionconfig.target),clearTimeout(this.submitTimeoutID),this.submitTimeoutID=0,a(window).off("beforeunload",this.submitFormCallback),M.util.js_complete(d)},submitForm:function(){e("Onchange submit client action occurring for "+this.actionconfig.target),this.form.submit(),this.submitTimeoutID=0,a(window).off("beforeunload",this.submitFormCallback),M.util.js_complete(d)},toString:function(){return"[object OnChangeSubmitAction]"}}),{init:function(a,b,c){var d=new f(a,b);d.init(),c(d)}}});