define(["jquery","totara_form/form","totara_form/clientaction_base"],function(a,b,c){var d="totara_form/form_clientaction_onchange_reload",e=function(a){var c="undefined"!=typeof arguments[1]?arguments[1]:b.LOGLEVEL.debug;b.debug(a,f,c)},f=function(){c.apply(this,arguments),this.initialValues=[],this.reloadTimeoutID=0,this.reloadFormCallback=a.proxy(this.reloadForm,this),this.ignoredValues=arguments[0].ignoredvalues||[]};return f=b.extend(c,f,{init:function(){var a=this.form.getElementById(this.actionconfig.target);return"undefined"==typeof a?void e("Unable to retrieve the element with id "+this.actionconfig.target,b.LOGLEVEL.error):(this.getWatchedIds().push(this.actionconfig.target),this.initialValues[this.actionconfig.target]=a.getValue(),void e("Registered onchange_reload client action for "+this.actionconfig.target))},checkState:function(){var a=!1;this.reloadTimeoutID&&this.cancelReloadForm(),this.getWatchedIds().forEach(function(c){if(a!==!0){e("Checking "+c+" for onchange_reload");var d,f=this.form.getElementById(c);if("undefined"==typeof f)return void e("Unable to retrieve the element with id "+this.actionconfig.target,b.LOGLEVEL.error);d=f.getValue();var g=function(a,b){var c;if(Array.isArray(a)&&Array.isArray(b)){if(a.length!==b.length)return!1;for(c=0;c<b.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b}(this.initialValues[c],d);g||(this.initialValues[c]=d,this.ignoredValues.indexOf(d.toString())===-1&&(f.showLoading(),a=!0))}},this),a&&(e("Onchange reload client action triggered for "+this.actionconfig.target),this.form.showLoading(),M.util.js_pending(d),this.reloadTimeoutID=setTimeout(this.reloadFormCallback,this.actionconfig.delay))},cancelReloadForm:function(){e("Clearing onchange reload client action timeout for "+this.actionconfig.target),clearTimeout(this.reloadTimeoutID),this.reloadTimeoutID=0,M.util.js_complete(d)},reloadForm:function(){e("Onchange reload client action occurring for "+this.actionconfig.target),this.form.reload(),this.reloadTimeoutID=0,M.util.js_complete(d)},toString:function(){return"[object OnChangeReloadAction]"}}),{init:function(a,b,c){var d=new f(a,b);d.init(),c(d)}}});