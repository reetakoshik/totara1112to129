define(["jquery","core/str","core/config"],function(a,b,c){var d={config:{},init:function(b){b&&(d.config=a.parseJSON(b));var c=a("input#id_submitbutton").closest("form"),e=a("<input>").attr({type:"hidden",name:"submitaction"}).val("saveprogress"),f=a("<input>").attr({type:"hidden",name:"submitaction"}).val("completestage");a("#saveprogress").on("submit",function(a){window.onbeforeunload=null,a.preventDefault(),c.append(e),c.submit()}),a("#completestage").on("submit",function(a){window.onbeforeunload=null,a.preventDefault(),c.append(f),c.submit()}),window.dialogsInited?(d.stagesSelectDialog(),d.savePdfDialog()):(a.isArray(window.dialoginits)||(window.dialoginits=[]),window.dialoginits.push(this.stagesSelectDialog),window.dialoginits.push(this.savePdfDialog)),setInterval(d.keepAlive,1e3*d.config.keepalivetime)},stagesSelectDialog:function(){var e=new totaraDialog_handler;e._print=function(b,d){var f=a("#printform").serialize();M.util.help_popups.setup(Y);var g={name:"printpopup",url:c.wwwroot+"/totara/appraisal/snapshot.php?"+f,options:"height=500,width=600,top=100,left=100,menubar=0,location=0,scrollbars,resizable,toolbar,status,directories=0,dependent"};openpopup(b,g),e._cancel()};var f={appraisalid:d.config.appraisalid,role:d.config.role,subjectid:d.config.subjectid,action:"stages"},g=a.param(f),h=[];h.push({key:"printnow",component:"totara_appraisal"}),h.push({key:"cancel",component:"moodle"}),h.push({key:"printyourappraisal",component:"totara_appraisal"}),b.get_strings(h).done(function(a){for(var b=[],d=0;d<h.length;d++)b[h[d].key]=a[d];var f={};f[b.printnow]=function(a){e._print(a,c.wwwroot+"/totara/appraisal/snapshot.php?"+g)},f[b.cancel]=function(){e._cancel()},totaraDialogs.print=new totaraDialog("print","show-print-dialog",{buttons:f,title:"<h2>"+b.printyourappraisal+"</h2>"},c.wwwroot+"/totara/appraisal/snapshot.php?"+g,e)})},savePdfDialog:function(){var e=new totaraDialog_handler;e._download=function(){var b=a("#downloadurl").val();b&&(window.location.href=b,e._cancel())},e._open=function(){e._dialog.dialog.html(b.get_string("snapshotgeneration","totara_appraisal"))};var f={appraisalid:d.config.appraisalid,role:d.config.role,subjectid:d.config.subjectid,action:"snapshot",sesskey:c.sesskey},g=a.param(f),h=[];h.push({key:"downloadnow",component:"totara_appraisal"}),h.push({key:"cancel",component:"moodle"}),h.push({key:"snapshotdialogtitle",component:"totara_appraisal"}),b.get_strings(h).done(function(a){for(var b=[],d=0;d<h.length;d++)b[h[d].key]=a[d];var f={};f[b.downloadnow]=function(){e._download()},f[b.cancel]=function(){e._cancel()},totaraDialogs.savepdf=new totaraDialog("savepdf","show-savepdf-dialog",{buttons:f,title:"<h2>"+b.snapshotdialogtitle+"</h2>",height:"200"},c.wwwroot+"/totara/appraisal/snapshot.php?"+g,e)})},keepAlive:function(){a.get(c.wwwroot+"/totara/appraisal/keepalive.php")}};return d});