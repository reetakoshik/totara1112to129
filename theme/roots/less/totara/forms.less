// This file is part of Totara LMS
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 3 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.
//
// @package   theme_roots
// @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
// @copyright 2015 Bas Brands <www.sonsbeekmedia.nl>
// @author    Bas Brands
// @author    David Scotson
// @author    Joby Harding <joby.harding@totaralearning.com>
// @author    Rob Tyler <rob.tyler@totaralearning.com>

// Mixin for form labels - will NOT be output.
.form-label-display() {
    margin-top: 0;
    margin-bottom: 0;
    padding-top: (@padding-base-vertical + 1); // Default padding plus a border
}

// Basic mforms layout, used in resources, user profile etc.
.mform {
    .fitem {
        &:extend(.form-group);
        &:extend(.form-horizontal .form-group);
        .fitemtitle {
            .make-md-column(4);
            .make-lg-column(3);
            label {
                .form-label-display;
            }
            .fstaticlabel {
                &:extend(label);
                .form-label-display;
            }
        }
        .felement {
            .make-md-column(8);
            .make-lg-column(9);
        }
        select[multiple],
        select[size] {
            height: auto;
        }
        .felement.fduration input[type="text"] {
            min-width: 0;
            width: 5em;
            display: inline-block;
        }
        .felement.fduration,
        .felement.fdate_selector,
        .felement.fdate_time_selector,
        .felement.fgroup {
            select {
                width: auto;
                display: inline-block;
                min-width: 60px;
            }
            select[size],
            select[multiple] {
                height: auto;
            }
            label {
                display: inline-block;
            }
        }
        .felement.fgroup input[type="text"] {
            min-width: unset;
            display: inline;
        }
    }

    .fitem_actionbuttons {
        .form-group;
        .form-horizontal .form-group;
        > div.felement {
            .make-md-column(8);
            .make-md-column-offset(4);
            .make-lg-column(9);
            .make-lg-column-offset(3);
        }
    }
}

.mform fieldset .advancedbutton {
    text-align: right;
}

.jsenabled .mform .containsadvancedelements .advanced {
    display: none;
}

.mform .containsadvancedelements .advanced.show {
    display: block;
}

.mform fieldset.group {
    margin-bottom: 0;
}

.mform span.error {
    background-color: @state-danger-bg;
    color: @state-danger-text;
}

.mform fieldset.error {
    border: 1px solid @state-danger-border;
}

.jsenabled .mform .collapsed .fcontainer {
    display: none;
}

// These are for javascript hide/show, not actual links
.mform legend a,
.mform legend a:hover {
    color: @legend-color;
    text-decoration: none;
}

.mform label .req,
.mform label .adv {
    cursor: help;
}

.mform .iconhelp {
    margin-left: 4px;
}

.mform legend .iconhelp {
    font-size: @font-size-base; // The help icon should always be the same size as the font.
}

// Basic admin forms layout.

.form-item {
    &:extend(.form-group);
    &:extend(.form-horizontal .form-group);
    .form-label {
        .make-md-column(4);
        label {
            .form-label-display;
        }
    }
    .form-setting {
        .make-md-column(8);
        select,
        input[type="text"],
        input[type="password"] {
            .form-control;
        }
        select[size],
        select[multiple] {
            height: auto;
        }
        .form-group {
            margin-bottom: 0;
            // name clash with Bootstrap form-group
        }
    }
    .form-description {
        .make-md-column(8);
        .make-md-column-offset(4);
        clear: left;
        margin-bottom: 0;
    }
}

form select,
form input[type="text"],
form input[type="password"],
form.atto_form input[type="url"],
select.singleselect {
    .form-control;
    width: auto;
    max-width: 300px;
    display: inline;
    margin: 0 0 5px 0;
}

// In some places, selects are incorrectly used outside of a form tag, resulting
// in the form-control class not being applied to the element and affecting the
// appearance of the element. This addresses the problem. The long term solution
// is to correct the mark-up. TL-10346 raised to address this.
select {
    .form-control;
}

.path-admin .buttons,
.form-buttons {
    .make-md-column(8);
    .make-md-column-offset(4);
    margin-left: -15px; // There's no row container, needs negative margin at small sizes
    margin-bottom: 15px;
    .form-submit {
        margin-left: 0;
    }
}

.path-admin .buttons.enrolled-learning-buttons,
.path-admin .buttons.visible-learning-buttons {
    float: none;
    width: 100%;
}

.form-defaultinfo,
.form-label .form-shortname {
    .text-muted;
    font-size: @font-size-small;
}

#adminsettings h3 {
    &:extend(legend);
}

.form-setting .form-checkbox input {
    margin-top: 12px;
}

.form-setting .form-multicheckbox ul {
    &:extend(.list-unstyled);
}

// Shared styles

.fcheckbox > span > label,
.form-checkbox + label,
.form-multicheckbox label {
    &:extend(.checkbox label);
    padding-left: 0.3em;
    padding-right: 0.3em;
}

// At this width and above the form label stacks beside the control
@media (min-width: @screen-md-min) {
    .mform .fitemtitle,
    .form-label {
        .form-shortname {
            display: block;
        }
    }

    .form-setting .form-multicheckbox,
    .fitem_fcheckbox .fcheckbox {
        padding-top: 8px;
    }

    .mform .fitem_actionbuttons > div.felement {
        padding-left: 10px;
    }

    .form-buttons .form-submit {
        margin-left: -5px;
    }

    .form-item .form-setting,
    .mform .fcontainer .fitem .felement {
        > input[type="text"],
        > input[type="password"] {
            width: auto;
            // Disabling min with just to try
            // min-width: 480px;
            margin-bottom: 5px;
        }
    }

    #page-mod-quiz-mod #id_reviewoptionshdr .fitem.fitem_fgroup {
        font-size: @font-size-small;
        .fitemtitle {
            min-height: 3.5em;
        }
    }

}

@media (max-width: @screen-sm-max) {

    // Fake a responsive grid for the quiz review options section.
    #page-mod-quiz-mod #id_reviewoptionshdr .fitem.fitem_fgroup {
        float: none;
        width: 100%;
    }
}

.mform .felement.fstatic,
.form-item .form-description {
    margin-bottom: 0;
    p:last-child {
        margin-bottom: 0;
    }
}

// despite crazy name, roughly equivalent to bootstrap's .form-inline
.invisiblefieldset {
    display: inline;
    margin: 0;
    padding: 0;
    border-width: 0;
}

input[type="radio"],
input[type="checkbox"] {
    margin: 0 4px;
}

/* Section and module editing forms contain special JS components for the
   availability system (if enabled). */
#fitem_id_availabilityconditionsjson {
    select,
    input[type=text] {
        width: auto;
        display: inline-block;
        height: 30px;
        line-height: 30px;
        padding: 4px 6px;
    }
    #timeamount {
        width: 3em;
    }
    label {
        display: inline;
    }
    .availability-group {
        margin: 5px;
    }

    .availability-item {
        margin-bottom: 6px;
    }

    .availability-header {
        padding: 5px;
    }

    .availability-plugincontrols {
        padding: 5px;
        background: none repeat scroll 0 0 @well-bg;
        border: 1px solid @well-border;
        border-radius: @border-radius-base;
        display: inline-block;
    }

    /* Hidden eye icon still takes up space. */
    .availability-eye[aria-hidden=true] {
        display: inline;
        visibility: hidden;
    }

    .availability-children .availability-eye .flex-icon {
        vertical-align: top;
        margin-top: 12px;
    }
    /* Add button lines up with child elements. */
    .availability-button {
        margin-left: 15px;
    }
    /* Nested section is grey. */
    .availability-childlist > .availability-inner {
        display: inline-block;
        background: @well-bg;
        border: 1px solid @well-border;
        border-radius: 4px;
        padding: 6px;
        margin-bottom: 6px;
    }
    /* Second (and more) levels of nested sections are white. */
    .availability-childlist .availability-childlist > .availability-inner {
        background: white;
    }
    /* Connecting text needs to be indented. */
    .availability-connector {
        margin-left: 20px;
        margin-bottom: 6px;
    }
}

/* This dialogue is used to add an availability condition. */
.availability-dialogue {
    .moodle-dialogue .moodle-dialogue-bd {
        padding-left: 0;
        padding-right: 0;
        padding-bottom: 2px;
    }
    ul {
        display: block;
        margin: 0;
    }
    li {
        display: block;
        list-style-type: none;
        padding: 0 10px 4px;
        clear: both;
        border-bottom: 1px solid @gray-lighter;
        margin-bottom: 4px;
    }
    ul button {
        float: left;
        min-width: 140px;
        margin-top: 4px;
        display: inline;
        white-space: normal;
    }
    label {
        margin-bottom: 0;
        display: block;
    }
    .availability-buttons button {
        margin-left: 1em;
        margin-right: 1em;
        margin-top: 4px;
    }
}

/* Custom styles for autocomplete form element */
.mform .felement.fautocomplete input[type="text"] {
    display: inline;
}

.form-autocomplete-selection {
    margin: 0.2em;
    min-height: 21px;
}

.form-autocomplete-multiple [role=listitem] {
    cursor: pointer;
}

.form-autocomplete-suggestions {
    position: absolute;
    background-color: white;
    border: 2px solid @gray-lighter;
    border-radius: 3px;
    min-width: 206px;
    max-height: 20em;
    overflow: auto;
    margin: 0;
    padding: 0;
    margin-top: -0.2em;
    z-index: 1;
    li {
        list-style-type: none;
        padding: 0.2em;
        margin: 0;
        cursor: pointer;
        color: @text-color;
    }
    li:hover {
        background-color: lighten(@dropdown-link-active-bg, 15%);
        color: @dropdown-link-active-color;
    }
    li[aria-selected=true] {
        background-color: darken(@navbar-default-bg, 5%);
        color: @gray;
    }
}

.form-autocomplete-downarrow {
    color: @text-color;
    position: relative;
    left: -1.5em;
    cursor: pointer;
}

.form-autocomplete-selection:focus {
    outline: none;
}

.form-autocomplete-selection [data-active-selection=true] {
    padding: 0.5em;
    font-size: large;
}

// End of original bootstrap theme code.

.mform .fitem_fgroup .felement input[type="text"],
.mform .fitem_fgroup .felement input[type="password"] {
    display: inline-block;
}

.mform .fitem .felement input[type="checkbox"],
.mform .fitem .felement input[type="radio"] {
    vertical-align: (@line-height-computed * -.2);
}

.mform .fitem_fscheduler .felement select,
.mform .fdate_time_selector .felement select,
.mform .fgroup .felement select {
    width: auto;
    display: inline-block;
    margin-right: @padding-xs-horizontal;
}

.mform .fgroup .felement input[type="text"] {
    margin-right: @padding-small-horizontal;
}

.mform .fgroup .felement label {
    font-weight: normal;
}

.mform .fitem .fduration .felement {
    > input,
    > select,
    > span {
        display: inline-block;
    }

    select {
        width: auto;
        margin-left: @padding-xs-horizontal;
    }
}

// 'Required information' text at the top of a form.
.mform .fdescription.required {
    margin-bottom: @line-height-computed;
}

// Collapsible section headers.
.mform .collapsible .ftoggler .fheader {
    margin-left: 0;
}

// For grouped elements with no label.
.mform .femptylabel .fgroup .felement {
    float: right;
}

.mform span.error {
    color: @state-danger-text;
    background-color: inherit;
    display: block;
    clear: both;
}

.mform .fitem_fpassword .felement.fpassword {
    > input {
        display: inline-block;
    }
}

//
// Form elements inside tables (e.g. Reportbuilder columns).
//
.mform table .fitem {
    // Remove default margins set by Bootstrap
    // for form elements in this situation as
    // it causes them to overlap table cells.
    margin-right: 0;
    margin-bottom: 0;
    margin-left: 0;
}

.mform td .fitem .fcheckbox {
    margin-top: (@line-height-computed * 0.4);
}

div#dateselector-calendar-panel {
    z-index: 3100; /* Fix for calendar pickers in dialogs & filepickers - see MDL-39047. */
}

.mform .helptooltip {
    a {
        color: @link-color;

        &:hover {
            color: @link-hover-color;
        }
    }
}

//
// Fix multi-line user selection forms.
//

.user-multiselect label[for="addselect"],
.user-multiselect label[for="removeselect"] {
    display: block;
}

.user-multiselect .controls {
    margin-top: @line-height-computed * 9;
    padding: 0;
}

#id_remove_all_items {
    margin-bottom: @padding-small-vertical;
}

.user-multiselect .controls button,
.user-multiselect .controls input {
    display: block;
    margin: @padding-large-vertical auto;
}

.user-multiselect select[multiple='multiple'] {
    max-width: none;
    width: 100%;
    margin-bottom: @line-height-computed;
    margin-left: 0;
    height: @line-height-computed * 20;
    overflow-x: auto;
}

#assignform .userselector label,
#assignform .userselector input[type='text'],
#assignform .userselector input[type='button'] {
    margin: 0 @padding-small-horizontal 0 0;
}

#userselector_options p input,
#userselector_options p label {
    vertical-align: middle;
    margin: 0 @padding-xs-horizontal 0 0;
}

// Admin settings pages have their own time select markup.
// They use the .form-time class exclusively in the system
// so use that to target them for tweaks without affecting
// other form elements.
.form-item .form-time {
    select {
        width: auto;
        display: inline-block;
        margin-left: @padding-xs-horizontal;
        &:first-of-type {
            margin-right: @padding-xs-horizontal;
            margin-left: @padding-small-horizontal;
        }
    }
}

//
// Date selector.
//
// Fieldsets which group elements to form a single input
// component e.g. Date selector (3 X <select>).
.fitem > fieldset {
    > legend {
        font-size: @font-size-base;
        border-bottom: none;
        margin-top: 0;

        // Negative margin coming in from grid.less
        margin-right: 0;
        margin-left: 0;

        padding-top: 0;
        &:extend(.fitemtitle);
        &:extend(.mform .fitemtitle);

        &:extend(.form-horizontal .form-group);
        .make-md-column(4);
        .make-lg-column(3);

        .legend {
            &:extend(label);
            &:extend(.mform .fitem .fitemtitle label);
            padding-top: (@padding-base-vertical + 1); // Default padding plus a border
        }
    }
}

.fdate_selector legend {
    &:extend(.mform .fitem .fitemtitle label);
}

.mform .fdate_selector .felement select {
    &:extend(.mform .fitem .felement.fdate_selector select);
}

//
// .form-multicheckbox
// e.g. Seminar global settings.
//
.form-setting .form-multicheckbox ul {
    margin-left: 0;
}

/*******************************************************************************
 * jQuery Datepicker UI skin overrides
 ******************************************************************************/
/* Invert element order without affecting position of Datepicker element */
.dir-rtl input.hasDatepicker {
    /*!rtl:ignore*/
    float: right;
}

textarea#id_approval_termsandconds {
    .path-mod-facetoface & {
        width: 100%;
        height: (@line-height-computed * 7);
    }
}

.dl-horizontal dt label {
    padding-top: 7px;
}

.totara_passwordunmask .unmask-password-option {
    display: none;
}

.jsenabled .totara_passwordunmask {
    .unmask-password-option {
        display: inline-block;
        vertical-align: text-top;
    }
    input {
        font-family: "Courier New", Courier, monospace;
    }
    .wrap {
        position: relative;
        display: inline-block;
    }
    input.passwordinput[type="text"] {
        -webkit-text-fill-color: transparent;
        color: transparent;
        background-color: transparent;
        position: absolute;
        left: 0;
        bottom: 0;
    }
    input.passwordinput[type="text"]::selection {
        background-color: gray;
        color: gray;
    }
    .inputmask {
        overflow: hidden;
        z-index: 0;
    }
    &.unmask-password {
        input.passwordinput[type="text"] {
            -webkit-text-fill-color: inherit;
            color: inherit;
            background-color: inherit;
            position: inherit;

            &[readonly] {
                background-color: @totara_form-disabled-bg;
                opacity: 1; // iOS fix for unreadable disabled content; see https://github.com/twbs/bootstrap/issues/11655
            }
        }
        .inputmask {
            display: none;
        }
    }
}

// Safari input is broken with user-select: none
.safari.jsenabled .totara_passwordunmask input.passwordinput[type="text"] {
    -webkit-user-select: text;
    user-select: text;
}
